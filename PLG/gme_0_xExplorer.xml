<App Type="SUBMENU" Category="6" Icon="FOLDER">
  <Name>
    <String str="File Explorer" />
    <String str="Explorateur de fichiers" />
    <String str="Explorador de Archivos" />
    <String str="Datei-Explorer" />
    <String str="Esplora file" />
    <String str="Bestandsverkenner" />
    <String str="Explorador de arquivos" />
  </Name>
  <Init>
    <![CDATA[
			function SetMCdescriptions(SubMenu) {
				for (let j = 0; j < SubMenu.Items.length; j++)	{
					MainMutex.unlock();
          if (!SubMenu.Items[j].Name.includes("Memory Card ")) { MainMutex.lock(); continue; }
          let mcSlot = SubMenu.Items[j].Name === "Memory Card 1" ? 0 : 1;
					let mcInfo = System.getMCInfo(mcSlot);
					MainMutex.lock();
					const free = mcInfo.freemem;
					const total = (free >= 58000) ? 65536 : (free >= 29000) ? 32768 : (free >= 14500) ? 16384 : 8192;
					const used = Math.min(Math.max(total - free, 0), total);
					const usedMb = (used / 1024).toFixed(1);
					const totalMb = (total / 1024).toFixed(0);
					SubMenu.Items[j].Description = `${usedMb} / ${totalMb} MB`;
				}
			}
    ]]>
  </Init>
  <Options Type="Explorer"/>
  <Context Name="FileContext" Type="OptionContext" Filter="SubDeviceOnly">
		<Component Name="{DELETE}" Icon="-1">
			<Confirm Event="OPEN_DIALOG" Dialog="item.Dialog" />
      <Dialog Type="CONFIRMATION" BG="false" BackBtn="true" ConfirmBtn="true">
				<Text>
					<String str="Do you want to delete the selected item?" />
					<String str="Do you want to delete the selected item?" />
					<String str="Â¿Seguro que deseas eliminar el objeto seleccionado?" />
					<String str="Do you want to delete the selected item?" />
					<String str="Do you want to delete the selected item?" />
					<String str="Do you want to delete the selected item?" />
					<String str="Do you want to delete the selected item?" />
				</Text>
				<Dialog Name="DeleteItemDialogTask" BG="false" Type="TEXT" Text="{WAIT}">
					<Task>
						<![CDATA[
							function() {
								const collection = DashUI.SubMenu.ItemCollection[DashUI.SubMenu.Level].Items;
                deleteItem(collection, DashUI.SubMenu.Items.Current);
								if (collection.length < 1) { DashUI.SubMenu.Items.Current = -1; }
								else if (DashUI.SubMenu.Items.Current >= collection.length) { DashUI.SubMenu.Items.Current = collection.length - 1; }
								UIAnimationDialogFade_Start(false);
							}
						]]>
					</Task>
				</Dialog>
				<Event On="Confirm" Type="Transition" To="DeleteItemDialogTask" Condition="DashUI.Dialog.Data[DashUI.Dialog.Level].Selected === 0" Exit="true"/>
			</Dialog>
		</Component>
    <Component Name="{INFO}" Icon="-1">
      <Confirm Event="OPEN_DIALOG" Dialog="item.Dialog" />
      <Dialog Type="INFO" BG="false" BackBtn="true" ElementIcon="true" >
        <Info>
          <Item Name="{TITLE}" Value="{DashUI.SubMenu.HighlightedItem.Name}" Selectable="false" />
          <Item Name="{DEVICE}" Value="{DashUI.SubMenu.HighlightedItem.Device}" Selectable="false" />
          <Item Name="{SIZE}" Value="{DashUI.SubMenu.HighlightedItem.Description || '0 bytes'}" Selectable="false" />
        </Info>
      </Dialog>
    </Component>
  </Context>
</App>
